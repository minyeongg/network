# 8.4 멀티캐스트 라우팅

## 8.4.1 유니캐스팅

## 8.4.2 멀티캐스팅

- 소스 주소는 유니캐스트 주소, 목적지 주소는 그룹 주소(D 클래스 주소 : 하나의 호스트가 아닌 여러 호스트가 같이 사용하는 주소. 즉 데이터를 여기로 보내면 여러 노드가 받게 됨.)<br>
- 그룹 주소는 그룹의 멤버를 지정.<br>
- 멀티캐스팅 vs 멀티플 유니캐스팅(비효율적임. 똑같은 데이터를 전달하는데 여러 카피를 만들어야 하기 때문.)<br>

## 멀티캐스트의 2가지 접근 방법

- 멀티캐스트 라우팅에서도, 유니캐스트 라우팅과 같이 소스에서 목적지까지 최적 경로 트리 필요<br>
- 멀티캐스트 라우팅에서는 목적지 주소뿐만 아니라, 소스의 주소도 고려함<br>
- 2가지 접근법 : 소스 기반 트리 라우팅, 그룹 공유 트리 라우팅<br>

### 소스 기반 트리

- 각 소스를 루트로 하는 트리<br>
- m 그룹 당 소스 n개 만큼의 트리 : m x n 개의 트리<br>

### 소스 기반 트리 접근방식

- 두 가지 방식 :<br>
  RIP를 확장한 DVMRP 방식<br>
  OSPF를 확장한 MOSPF 방식<br>

### 8.4.3 DVMRP

- Distance Vector Multicast Routing Protocol는 유니캐스트 라우팅에 사용되는 RIP의 확장<br>
- 소스 기반 트리 접근방법을 사용함<br>
- 소스 기반 멀티캐스트 트리를 생성해야 함<br>
- 멀티캐스트 트리 생성 단계:<br>
  - 역경로 포워딩 (Reverse Path Forwarding):<br>
    유니캐스트 라우팅 테이블을 참조하여 소스가 어디에 있는지 파악하고, 멀티캐스트의 소스가 있는 방향으로부터 온 패킷만을 포워딩하고, 다른 데서 온 패킷은 무시함.<br>
    따라서 루프(고리) 현상이 제거됨.<br>
  - 역경로 브로드캐스팅 (Reverse Path Broadcasting):<br>
    패킷이 여러개가 들어올 수 있으니 부모 노드를 정해서 하나만 수신하게 함.<br>
  - 역경로 멀티캐스팅 (Reverse Path Multicasting):<br>
    IGMP를 통해 모은 정보를 기초로, 해당 그룹에 속한 멤버가 없으면 우리를 트리에서 제거해달라고 하는 Prune 메시지를 교환함.<br>
    새로운 멤버가 생기면 다시 IGMP를 통해 알리고 Join이라는 메시지를 주고받음.<br>

### 8.4.4 MOSPF(Multicast Open Shortest Path First) ---> 강의 다시 듣기

- Open Shortest Path First의 확장<br>
- 소스 기반 트리 접근방법<br>
- 각 라우터에 있는 그룹 멤버 정보를 통해서 트리 생성 :<br>
  그룹 내의 각 소스를 루트로 하는 트리 생성<br>
  라우터 자신을 루트로 하는 서브트리 생성<br>
  멤버가 없는 경로를 prune<br>
  각 라우터는 IGMP를 통해 멤버 정보를 만들어, 플러딩을 통해
  모든 라우터에게 정보 전달

### 8.4.5 Protocol Independent Multicast(PIM) ---> 강의 다시 듣기

- 거리 벡터 프로토콜이나 링크 상태 프로토콜이 아닌, 유니캐스트 라우팅 프로토콜이 필요한 일반 프로토콜을 말함
- 목적지까지의 경로 내의 다음 라우터를 찾기 위해 유니캐스트 라우팅 프로토콜의 테이블을 사용해야 하지만 포워딩 테이블이 어떻게 생성되는지는 신경쓰지 않음
- 유니캐스트 라우팅 프로토콜 종류와 관계없이 사용가능한 멀티캐스트 프로토콜<br>
- 2가지의 모드 :<br>
  dense mode : 그룹의 액티브 멤버가 많을 때<br>
  sparse mode : 소수 라우터만이 액티브 멤버를 가질 때<br>
- PIM-DM :<br>
  트리를 만들어서 플러딩하는 형태<br>
  DVMRP와 비슷하지만 단순화 한 형태( 세 단계 중 RPF와 RPM만 사용)<br>
  따라서 2 step임 :<br>
  1. 패킷 수신 시 RPF 알고리즘 사용하여 수신 방향 검사<br>
  2. 수신 방향 맞으면 처음에는 broadcasting, prune 이후는 멀티캐스팅<br>
- PIM-SM :<br>
  그룹 공유 트리<br>
  랑데뷰 포인터를 선택하는 알고리즘이 필요<br>
  2 step :<br>
  1. 소스에서 유니캐스트 터널링을 통해 멀티캐스트 패킷을 랑데뷰 포인터로 전달<br>
  2. 랑데뷰 포인터에서 공유트리로 포워딩<br>
     따라서 그룹마다 공유트리, 랑데뷰 포인터 한 개씩 필요<br>

## 8.5 IGMP

- 라우터들이 자신의 네트워크 안에 그룹 멤버가 있는지 없는지를 파악하는 데 사용하는 프로토콜<br>

### 8.5.1 메시지

- 요청과 응답은 IP 패킷에 캡슐화되어 전달됨<br>
- IGMPv3 메시지:<br>
  Query 메시지:<br>
  라우터가 네트워크 내의 모든 호스트에게 주기적으로 보내는 것으로, 특정 그룹의 멤버가 있는지를 확인함.<br>
  Report 메시지:<br>
  호스트가 query 메시지에 대해서 응답하는 것<br>

### 8.5.2 멤버십 정보의 전파

- 라우터가 멤버십 정보를 수집한 후에 트리의 최상위 레벨의 라우터에 전파함<br>
- 최상위 라우터는 멀티캐스트 트리를 만들기 위해 멤버십 정보를 모음

### 8.5.3 캡슐화

- 페이로드 부분에 IGMP 메시지가 들어감.<br>
- 프로토콜 필드값이 2인 경우가 IGMP 메시지임.<br>
- TTL 필드값은 1임 : 라우터를 거칠 때마다 하나씩 줄이고 0 이되면 폐기하는 데 1이라는 것은 현재 네트워크 내에서만 전파하는 것. 즉 IGMP 메시지는 TTL이 1임.<br>
- 그러나 패킷의 목적지 IP주소는 요청, 응답 등 메시지 유형마다 다름.<br>
