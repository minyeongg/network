# 1. 데이터 교환 절차

ARP : IP주소는 알고있는데 MAC주소를 모를때 사용<br>
실제 로컬 통신에서는 MAC 주소가 필요하기 때문에 통신하려는 IP 주소를 갖는 시스템의 MAC 주소 해결이 필요함<br>
ARP 요청은 브로드캐스트됨 -> 모든 station이 수신<br>
ARP 응답은 유니캐스트임(자기를 찾는 컴퓨터에게만 보냄)-> MAC 주소 해결

# 2. MAC 주소

- IEEE에서 할당, 48비트:<br>
  24비트는 제조회사에서 할당, 24비트는 serial number<br>
- 16진수 표시(- 혹은 : 로 구분)<br>
- MAC 주소 종류 :<br><br>

1. 브로드캐스트 : 모든 Station이 수신하는 주소. FF-FF-FF-FF-FF-FF(즉 모든 비트가 1). IP Broadcast나 ARP 요청에서 사용됨.<br>
2. 멀티캐스트 주소 : 특정 그룹에 가입한 station들이 수신하는 주소. Multicast IP를 가지고 만듦.<br>
3. 유니캐스트 주소 : 특정한 하나의 스테이션 주소. 즉 LAN 카드에 내장된 주소<br>
   일반적으로는 3을 쓰지만 1이나 2를 쓸 때도 있다는 뜻.

# 3. 패킷과 프레임 교환

## 1. 패킷과 프레임 전달

- 실질적으로 소스에서 목적지까지 전달되는건 패킷이지만<br>
  중간에 라우터나 스위치 등 여러 구간을 거치는데 그 구간 구간에서는 프레임이라는 데이터 단위로 전달됨.<br>
- 하나의 station(IP 주소 sa, MAC 주소 SA)이 인접한 다른 station(IP 주소 da, MAC 주소 DA) 으로 패킷을 보내려 할 때<br>
  프레임을 만들어 패킷을 담아 보내야함.<br>
  프레임을 만들 때는 목적지 MAC 주소(DA)와 발신자 MAC 주소(SA)가 필요함.<br>
  SA는 자신의 LAN카드에 있음. DA를 알 수 있는 방안이 필요함 ->ARP가 목적지 MAC 주소를 해결<br>

## 2. 패킷과 프레임 구조

로컬 네트워크에서 스테이션 사이의 데이터의 흐름은 결국 이더넷 프레임이 왔다갔다 하는 것임. 물론 무선랜인 경우에는 무선랜 프레임일 것임.<br>
프레임 구조 : DA(6) + SA(6) + Type(데이터가 어떤 종류의 데이터인지. 일반적으로 IP 패킷임. 2) + Data(~1500) + FCS(4), 단위는 바이트. sa와 da는 IP 패킷 내에 있음.<br>

## 3. ARP 동작

패킷을 보내려는 스테이션은 목적지 스테이션의 MAC 주소를 찾는 ARP 요청 패킷을 방송(Broadcast)<br>
연결된 모든 슽이션이 ARP 요청 패킷을 수신<br>
찾는 주소가 자신의 IP라면 목적지 스테이션이 자신의 MAC 주소 정보를 담은 ARP 응답 패킷을 전송(유니캐스트)<br>
송신 스테이션은 목적지 IP 주소와 MAC 주소 매핑정보를 ARP 캐시에 저장하고 일정기간 사용.<br>
사용하지 않는 시간이 길어지면, 타임아웃되어 매핑정보가 캐시에서 사라짐.<br>
arp -a : arp 캐시 내용 확인 명령<br>
ping [목적지의 주소]

## 4. 스테이션의 수신 동작

모든 스테이션은 브로드캐스트 프레임은 다 수신함.<br>
각 스테이션은 자신이 가입한 멀티캐스트 프레임 수신.<br>
각 스테이션은 목적지 MAC 주소가 자신의 MAC 주소와 일치하는 유니캐스트 프레임 수신.<br>
브리지(특수한 종류의 네트워크 장비)는 모든 프레임을 다 수신하여 처리(promiscuous mode라고 함.)<br>
라우터는 일반 스테이션과 같이모든 브로드캐스트, 가입된 멀티캐스트, 자신에게 오는 유니캐스트 프레임 수신.<br>

## 5. 목적지가 같은 네트워크에 있는 경우

- 송신자와 수신자가 인접 시스템(같은 네트워크에 있는 경우, 즉 라우터 없이 직접 통신 가능. 물론 스위치를 통해서 연결될 수는 있음. 그러나 스위치는 투명한 장치라고 해서 스위치가 있든 없든 통신하는 방법은 변함이 없음)<br>
  - 송신 스테이션은 프레임을 만들어서, 목적지 MAC 주소를 DA에 넣고, 자신의 MAC 주소를 SA에 넣고, 프레임의 데이터 영역에 패킷을 넣어 전송<br>
  - 모든 스테이션은 항상 지나가는 프레임을 hearing(감지)하다가, DA주소가 자신의 MAC 주소와 일치하는 프레임 수신<br>
  - 수신 스테이션이 MAC 프레임을 수신하여 오류검사(프레임의 FCS 필드를 보고 오류검사) 후 이상이 없으면<br>
  - 프레임으로부터 패킷을 분리하여 상위계층으로 전달함.

## 6. 목적지가 같은 네트워크인지 판단

패킷과 프레임의 교환 절차에서 가장 먼저 해야 할 일<br>
스테이션의 서브넷 마스크를 이용해 판단<br>

- 같은 네트워크인 경우:<br>
  목적지 IP 주소 AND 서브넷 마스크 = 출발지 IP 주소 AND 서브넷 마스크 인 경우 직접통신 가능<br>
- 다른 네트워크인 경우:<br>
  목적지 IP 주소 AND 서브넷 마스크 != 출발지 IP 주소 AND 서브넷 마스크 인 경우 직접통신 불가능<br>
  -> 라우터에게 보내면, 라우터가 알아서 전달해줌<br>

## 7. 서브넷마스크 bit and 계산

## 8. 목적지가 같은 네트워크인 경우 동작

    1. 목적지 MAC 주소를 알기 위해 ARP 요청 담은 프레임을 방송<br>
    2. 목적지에서 ARP 응답 담은 프레임을 유니캐스트로 전송<br>
    3. 패킷을 담은 프레임을 목적지로 전송<br>

## 9. 다른 네트워크인 경우 동작

소스 노드에서 목적지가 다른 네트워크에 있다고 판단되는 경우, 패킷을 라우터로 보내기 위한 동작을 개시<br>

1. 라우터의 MAC 주소를 ARP를 통해 해결<br>
2. 라우터의 MAC 주소를 MAC 프레임의 DA 필드에 넣고 보내려는 패킷을 DATA 필드에 넣은 프레임을 만들어 보내면, 프레임을 라우터가 수신함.<br>
3. 라우터는 패킷의 헤더에 있는 목적지 주소를 보고, 라우팅 테이블을 참조하여 패킷을 목적지로 전달함.

## 10. 목적지가 다른 네트워크인 경우 동작

    1. 라우터의 MAC 주소를 알기 위해 ARP 요청(이때 IP 주소 정보는 라우터의 IP 주소임) 담은 프레임을 방송<br>
    2. 라우터에서 ARP 응답 담은 프레임을 유니캐스트로 전송<br>
    3. 원래 목적지로 가는 패킷을 넣은 프레임을 만들어서 라우터로 가는 프레임을 전송(즉 패킷의 목적지는 라우터가 아님.)<br>
    4. 라우터는 목적지로 가는 패킷을 담은 프레임을 목적지 방향으로 전달.<br>

## 11. DNS 이름을 사용하는 경우

    - 목적지 주소가 www.snut.ac.kr과 같이 도메인 이름을 입력한 경우에는, DNS 서버에게 질의하여 도메인 이름에 해당하는 IP 주소값을 먼저 해결해야 함.<br>
    - DNS 서버로 가는 패킷을 만들어 보내는 절차가 먼저 일어남.<br>
    - DNS 서버가 같은 네트워크에 있을 수도 있고, 다른 네트워크에 있을 수도 있음. (서브넷 마스크로 판단)<br>
        같은 네트워크인 경우 : ARP를 통해 DNS 서버의 MAC 주소를 해결해서 보내야 함.<br>
        다른 네트워크인 경우 : DNS 서버로 보내는 질의 패킷을 라우터로 보내야 함. (라우터의 MAC 주소 해결 후)<br>

## 12. 목적지와 DNS 서버가 다른 네트워크인 경우 동작

    1. 라우터의 MAC 주소를 알기 위해 ARP 요청(이때 IP 주소 정보는 라우터의 IP 주소임) 담은 프레임을 방송<br>
    2. 라우터에서 ARP 응답 담은 프레임을 유니캐스트로 전송<br>
    3. 소스에서 DNS 질의 패킷 담은 프레임을 라우터로 전송<br>
    4. 라우터는 DNS 질의 패킷을 담은 프레임을 DNS로 전달<br>
    5. 라우터는 DNS 질의 응답 패킷을 담은 프레임을 수신<br>
    6. 라우터는 DNS 질의 응답 패킷을 담은 프레임을 소스로 전달<br>
    7. 이하 생략

## 13. IP 주소 할당

    - 통신에 필요한 주소 정보 : IP 주소, 서브넷 마스크, 게이트웨이 주소(라우터 주소), DNS 서버 주소, 보조 DNS 서버 주소(DNS 서버가 다운되었을 때 대체할 DNS 서버 주소)<br>
    - IP 주소 자동 할당: DHCP(Dynamic Host Configuration Protocol) 서버를 이용; 컴퓨터를 켜면 자동적으로 이 서버에게 IP 주소 요청을 하게 되고 서버는 IP 풀 중에서 주소 하나를 할당해줌. 컴퓨터는 임대시간이 만료할 때까지 그 IP 주소를 쓰다가 만료되면 연장을 하거나 새로운 주소를 할당받음.<br>
    - IP 주소 수동 할당: 사람이 IP 주소를 직접 입력함. 한번 입력하면 계속 사용함. 중복되는 주소가 있는 경우 통신이 안되거나, 해당 네트워크가 비활성화되므로 주소가 중복이 안되게 관리자가 잘 할당해야됨.
